{% extends "base.html" %}
{% block title %}X√°c minh t√†i li·ªáu{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">

            {% if result is none %}
            <div class="card">
                <div class="card-header">
                    <h4>X√°c minh t√†i li·ªáu ƒë√£ k√Ω</h4>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" action="{{ url_for('verify_page') }}">
                        <div class="mb-3">
                            <label for="signed_pdf" class="form-label">T√†i li·ªáu PDF</label>
                            <input class="form-control" type="file" name="signed_pdf" accept=".pdf" required>
                        </div>

                        <div class="mb-3">
                            <label for="selected_user" class="form-label">Ng∆∞·ªùi k√Ω</label>
                            <select class="form-select" name="selected_user" required>
                                <option value="" disabled selected>-- Ch·ªçn ng∆∞·ªùi k√Ω ƒë·ªÉ x√°c minh --</option>
                                {% for user in users %}
                                <option value="{{ user.username }}">{{ user.display_name }} ({{ user.username }})</option>
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary">X√°c minh</button>
                    </form>
                </div>
            </div>
            {% endif %}

            {% if result is not none %}
            <div class="mt-4">
                <h5>K·∫øt qu·∫£ x√°c minh</h5>

                {% if result is sameas true %}
                <div class="alert alert-success">
                    <strong>Ch·ªØ k√Ω h·ª£p l·ªá.</strong> T√†i li·ªáu kh√¥ng b·ªã thay ƒë·ªïi k·ªÉ t·ª´ khi ƒë∆∞·ª£c k√Ω v√† ƒë√∫ng v·ªõi kh√≥a c√¥ng khai c·ªßa ng∆∞·ªùi k√Ω ƒë∆∞·ª£c ch·ªçn.
                </div>
                {% elif result is sameas false %}
                <div class="alert alert-danger">
                    <strong>Ch·ªØ k√Ω kh√¥ng h·ª£p l·ªá.</strong> D·ªØ li·ªáu ƒë√£ b·ªã thay ƒë·ªïi ho·∫∑c kh√¥ng tr√πng kh·ªõp v·ªõi ng∆∞·ªùi k√Ω ƒë∆∞·ª£c ch·ªçn.
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <strong>Kh√¥ng th·ªÉ x√°c minh ch·ªØ k√Ω.</strong> ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh x√°c minh ho·∫∑c thi·∫øu th√¥ng tin c·∫ßn thi·∫øt.
                </div>
                {% endif %}

                {% if details %}
                <div class="card mt-3">
                    <div class="card-header">Th√¥ng tin ch·ªØ k√Ω</div>
                    <ul class="list-group list-group-flush">
                        {% if details.signed_at %}
                        <li class="list-group-item"><strong>Th·ªùi gian k√Ω:</strong> {{ details.signed_at }}</li>
                        {% endif %}
                        {% if details.signer %}
                        <li class="list-group-item"><strong>Ng∆∞·ªùi k√Ω:</strong> {{ details.signer }}</li>
                        {% endif %}
                        {% if details.position %}
                        <li class="list-group-item"><strong>Ch·ª©c v·ª•:</strong> {{ details.position }}</li>
                        {% endif %}
                        {% if details.algorithm %}
                        <li class="list-group-item"><strong>Thu·∫≠t to√°n:</strong> {{ details.algorithm }}</li>
                        {% endif %}
                        {% if details.signature_id %}
                        <li class="list-group-item"><strong>M√£ ch·ªØ k√Ω:</strong> {{ details.signature_id }}</li>
                        {% endif %}
                    </ul>
                </div>

                <div class="card mt-3">
                    <div class="card-header">Th√¥ng tin ch·ª©ng ch·ªâ</div>
                    <ul class="list-group list-group-flush">
                        {% if details.cert_subject %}
                        <li class="list-group-item"><strong>Ch·ªß th·ªÉ:</strong> {{ details.cert_subject }}</li>
                        {% endif %}
                        {% if details.cert_issuer %}
                        <li class="list-group-item"><strong>Nh√† ph√°t h√†nh:</strong> {{ details.cert_issuer }}</li>
                        {% endif %}
                        {% if details.cert_valid_from %}
                        <li class="list-group-item"><strong>Hi·ªáu l·ª±c t·ª´:</strong> {{ details.cert_valid_from }}</li>
                        {% endif %}
                        {% if details.cert_valid_to %}
                        <li class="list-group-item"><strong>Hi·ªáu l·ª±c ƒë·∫øn:</strong> {{ details.cert_valid_to }}</li>
                        {% endif %}
                        {% if details.public_key %}
                        <li class="list-group-item">
                            <strong>Public Key:</strong>
                            <pre class="mb-0" style="white-space: pre-wrap;">{{ details.public_key }}</pre>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}

                {% if file_url %}
                <div class="mt-3">
                    <a href="{{ file_url }}" class="btn btn-secondary">T·∫£i file g·ªëc</a>
                </div>
                {% endif %}

                <div class="mt-3">
                    <a href="{{ url_for('verify_page') }}" class="btn btn-outline-primary btn-sm mt-3">üîÅ Ki·ªÉm tra file kh√°c</a>
                </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}
